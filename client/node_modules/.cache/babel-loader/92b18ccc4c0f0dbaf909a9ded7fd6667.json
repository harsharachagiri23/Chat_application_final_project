{"ast":null,"code":"import _regeneratorRuntime from\"/Users/harshavardhani/Documents/web_dev_tools/student-bos6250-harshaV0211/final/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"/Users/harshavardhani/Documents/web_dev_tools/student-bos6250-harshaV0211/final/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/harshavardhani/Documents/web_dev_tools/student-bos6250-harshaV0211/final/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/harshavardhani/Documents/web_dev_tools/student-bos6250-harshaV0211/final/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from\"react\";import{fetchActiveUsers}from'./services';import ScrollToBottom from\"react-scroll-to-bottom\";import'emoji-mart/css/emoji-mart.css';import{Picker}from'emoji-mart';import emojiIcon from'../icons/emojiIcon.png';import useOutsideClick from\"./useOutsideClick\";import\"./App.css\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";function Chat(_ref){var socket=_ref.socket,username=_ref.username,room=_ref.room,onLogout=_ref.onLogout,activeUsers=_ref.activeUsers;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),currentMessage=_useState2[0],setCurrentMessage=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),messageList=_useState4[0],setMessageList=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),users=_useState6[0],setUsers=_useState6[1];var _useOutsideClick=useOutsideClick(false),showEmoji=_useOutsideClick.showEmoji,setShowEmoji=_useOutsideClick.setShowEmoji,ref=_useOutsideClick.ref;var handleEmojiShow=function handleEmojiShow(){setShowEmoji(function(v){return!v;});};var handleEmojiSelect=function handleEmojiSelect(e){setCurrentMessage(function(currentMessage){return currentMessage+=e.native;});};var sendMessage=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var messageData;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(currentMessage!==\"\")){_context.next=6;break;}messageData={room:room,author:username,message:currentMessage,time:new Date(Date.now()).getHours()+\":\"+new Date(Date.now()).getMinutes()};_context.next=4;return socket.emit(\"send_message\",messageData);case 4:setMessageList(function(list){return[].concat(_toConsumableArray(list),[messageData]);});setCurrentMessage(\"\");case 6:case\"end\":return _context.stop();}}},_callee);}));return function sendMessage(){return _ref2.apply(this,arguments);};}();useEffect(function(){socket.on(\"receive_message\",function(data){setMessageList(function(list){return[].concat(_toConsumableArray(list),[data]);});});},[socket]);// Checks for new user in room and displays new users \nuseEffect(function(){var chatTimer=setTimeout(function(){fetchActiveUsers(room).then(function(userData){setUsers(userData);});},1*1000);return function(){clearTimeout(chatTimer);};},[users[\"users\"]]);// console.log(\"Data passed from parent component : \", users);\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"chat-window\",children:[/*#__PURE__*/_jsx(\"div\",{children:function(){if(Object.keys(users).length>0){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"Active Users In Room \",room]}),/*#__PURE__*/_jsx(\"ul\",{children:users[\"users\"].map(function(userInfo){// console.log(\"Inside map : \" , userInfo);\nreturn/*#__PURE__*/_jsx(\"li\",{children:userInfo.name});})})]});}else{// console.log(\"Inside ELSE BLOCK. ACTIVE USERS DATA : \", users);\nreturn/*#__PURE__*/_jsx(\"div\",{});}}()}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-header\",children:/*#__PURE__*/_jsx(\"p\",{children:\"Live Chat \"})}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-body\",children:/*#__PURE__*/_jsx(ScrollToBottom,{className:\"message-container\",children:messageList.map(function(messageContent){return/*#__PURE__*/_jsx(\"div\",{className:\"message\",id:username===messageContent.author?\"you\":\"other\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"message-content\",children:/*#__PURE__*/_jsx(\"p\",{children:messageContent.message})}),/*#__PURE__*/_jsxs(\"div\",{className:\"message-meta\",children:[/*#__PURE__*/_jsx(\"p\",{id:\"time\",children:messageContent.time}),/*#__PURE__*/_jsx(\"p\",{id:\"author\",children:messageContent.author})]})]})});})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-footer\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:currentMessage,placeholder:\"Hey...\",onChange:function onChange(event){setCurrentMessage(event.target.value);},onKeyPress:function onKeyPress(event){event.key===\"Enter\"&&sendMessage();}}),/*#__PURE__*/_jsx(\"button\",{onClick:sendMessage,children:\"\\u25BA\"}),/*#__PURE__*/_jsx(\"button\",{className:\"sendButton\",type:\"button\",onClick:handleEmojiShow,children:/*#__PURE__*/_jsx(\"img\",{className:\"uploadImage\",src:emojiIcon,alt:\"uploadImage\"})}),/*#__PURE__*/_jsx(\"div\",{children:showEmoji&&/*#__PURE__*/_jsx(\"div\",{ref:ref,children:/*#__PURE__*/_jsx(Picker,{onSelect:handleEmojiSelect,emojiSize:20})})})]}),/*#__PURE__*/_jsx(\"button\",{onClick:onLogout,children:\"Logout\"})]});}export default Chat;","map":{"version":3,"names":["React","useEffect","useState","fetchActiveUsers","ScrollToBottom","Picker","emojiIcon","useOutsideClick","Chat","socket","username","room","onLogout","activeUsers","currentMessage","setCurrentMessage","messageList","setMessageList","users","setUsers","showEmoji","setShowEmoji","ref","handleEmojiShow","v","handleEmojiSelect","e","native","sendMessage","messageData","author","message","time","Date","now","getHours","getMinutes","emit","list","on","data","chatTimer","setTimeout","then","userData","clearTimeout","Object","keys","length","map","userInfo","name","messageContent","event","target","value","key"],"sources":["/Users/harshavardhani/Documents/web_dev_tools/student-bos6250-harshaV0211/final/client/src/Chat.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport {  fetchActiveUsers } from './services';\nimport ScrollToBottom from \"react-scroll-to-bottom\";\nimport 'emoji-mart/css/emoji-mart.css'\nimport { Picker } from 'emoji-mart'\nimport emojiIcon from '../icons/emojiIcon.png';\nimport useOutsideClick from \"./useOutsideClick\";\nimport \"./App.css\";\n\nfunction Chat({ socket, username, room , onLogout, activeUsers}) {\n  const [currentMessage, setCurrentMessage] = useState(\"\");\n  const [messageList, setMessageList] = useState([]);\n  const [users, setUsers] = useState({});\n  const { showEmoji, setShowEmoji, ref } = useOutsideClick(false)\n  const handleEmojiShow = () => { setShowEmoji((v) => !v) }\n  const handleEmojiSelect = (e) => { setCurrentMessage((currentMessage) => (currentMessage += e.native)) }\n\n  const sendMessage = async () => {\n    if (currentMessage !== \"\") {\n      const messageData = {\n        room: room,\n        author: username,\n        message: currentMessage,\n        time:\n          new Date(Date.now()).getHours() +\n          \":\" +\n          new Date(Date.now()).getMinutes(),\n      };\n\n      await socket.emit(\"send_message\", messageData);\n      setMessageList((list) => [...list, messageData]);\n      setCurrentMessage(\"\");\n    }\n  };\n\n  useEffect(() => {\n    socket.on(\"receive_message\", (data) => {\n      setMessageList((list) => [...list, data]);\n    });\n    \n  }, [socket]);\n\n  // Checks for new user in room and displays new users \n  useEffect(() => {\n    let chatTimer = setTimeout(() => {\n      fetchActiveUsers(room).then(userData => {\n        setUsers(userData);\n      });\n    }, 1 * 1000);\n\n    return () => {\n      clearTimeout(chatTimer);\n    }\n    \n  }, [users[\"users\"]]);\n\n  // console.log(\"Data passed from parent component : \", users);\n\n  return (\n    <div className=\"chat-window\">\n        <div>\n            {(() => {\n              if (Object.keys(users).length > 0) {\n                return (\n                  <div>\n                     <h3>Active Users In Room {room}</h3>\n                     <ul>\n                        {users[\"users\"].map( (userInfo) =>{\n                          // console.log(\"Inside map : \" , userInfo);\n                          return  <li>{userInfo.name}</li>\n                        } )}\n                     </ul>\n                  </div>\n                )\n              } \n              else {\n                // console.log(\"Inside ELSE BLOCK. ACTIVE USERS DATA : \", users);\n                return (\n                  <div></div>\n                )\n              }\n            })()}\n      </div>\n      <div className=\"chat-header\">\n        <p>Live Chat </p>\n       \n      </div>\n      <div className=\"chat-body\">\n        <ScrollToBottom className=\"message-container\">\n          {messageList.map((messageContent) => {\n            return (\n              <div\n                className=\"message\"\n                id={username === messageContent.author ? \"you\" : \"other\"}\n              >\n                <div>\n                  <div className=\"message-content\">\n                    <p>{messageContent.message}</p>\n                  </div>\n                  <div className=\"message-meta\">\n                    <p id=\"time\">{messageContent.time}</p>\n                    <p id=\"author\">{messageContent.author}</p>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </ScrollToBottom>\n      </div>\n      <div className=\"chat-footer\">\n        <input\n          type=\"text\"\n          value={currentMessage}\n          placeholder=\"Hey...\"\n          onChange={(event) => {\n            setCurrentMessage(event.target.value);\n          }}\n          onKeyPress={(event) => {\n            event.key === \"Enter\" && sendMessage();\n          }}\n        />\n        <button onClick={sendMessage}>&#9658;</button>\n        <button\n          className=\"sendButton\"\n          type='button'\n          onClick={handleEmojiShow}>\n          <img\n            className=\"uploadImage\"\n            src={emojiIcon}\n            alt=\"uploadImage\" />\n        </button>\n        <div>\n        {showEmoji && (\n          <div ref={ref}>\n            <Picker\n              onSelect={handleEmojiSelect}\n              emojiSize={20} />\n          </div>\n        )}\n      </div>\n      </div>\n      <button onClick={onLogout}>Logout</button>\n    </div>\n  );\n}\n\nexport default Chat;"],"mappings":"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"},"metadata":{},"sourceType":"module"}